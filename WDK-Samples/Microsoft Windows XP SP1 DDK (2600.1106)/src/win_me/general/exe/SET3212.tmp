#****************************************************************************
# This makefile is intended to be used as a boilerplate for any DDK projects*
# requiring the building of both a SYS and an Application (EXE) to be used  *
# together. It assumes you have configured SETENV.BAT and executed it       *
#                                                                           *
# THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY     *
# KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE       *
# IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR     *
# PURPOSE.                                                                  *
#                                                                           *
# Copyright 1993-2000  Microsoft Corporation.  All Rights Reserved.         *
#                                                                           *
#****************************************************************************

!INCLUDE ..\makefile.mk

TARGET      = TESTAPP
OBJDIR      = obj
SRCDIR      = .

all: direxist $(OBJDIR)\$(TARGET).exe

direxist:
        -@if not exist $(OBJDIR)\nul md $(OBJDIR)

###############################################################################
# Build TARGET

INCLUDE=$(DDKROOT)\inc\win_me;$(MSVCDIR)\include;

INCFLAGS    = -I..\sys $(INCFLAGS)
CFLAGS      = $(CFLAGS) $(C_DEFINES)
LFLAGS      = $(LFLAGS) -subsystem:windows,4.00 -base:0x01000000 -entry:WinMainCRTStartup advapi32.lib kernel32.lib gdi32.lib user32.lib comctl32.lib

#multi-thread
CFLAGS     = $(CFLAGS) -D_MT=1
LFLAGS     = $(LFLAGS) libcmt.lib

{$(SRCDIR)\}.rc{$(OBJDIR)\}.res:
        $(RC) $(RCFLAGS) -fo$(@R).tmp %s
        @cvtres -nologo -machine:ix86 -readonly -out:$@ $(@R).tmp
        @-erase $(@R).tmp

{$(SRCDIR)\}.c{$(OBJDIR)\}.obj:
        $(CL) $(CFLAGS) -Fo$@ %s

{$(SRCDIR)\}.cpp{$(OBJDIR)\}.obj:
        $(CL) $(CFLAGS) -Fo$@ %s

$(OBJDIR)\$(TARGET).exe: $(OBJDIR)\TESTAPP.obj $(OBJDIR)\TESTAPP.res
        link @<<$(TARGET).crf
$(LFLAGS)
-OUT:$@ -MAP:$(@R).map $**
<<

######
clean:
        -@if exist $(OBJDIR)\*.obj del $(OBJDIR)\*.obj
        -@if exist $(OBJDIR)\*.vxd del $(OBJDIR)\*.vxd
        -@if exist $(OBJDIR)\*.exe del $(OBJDIR)\*.exe
        -@if exist $(OBJDIR)\*.sys del $(OBJDIR)\*.sys
        -@if exist $(OBJDIR)\*.map del $(OBJDIR)\*.map
        -@if exist $(OBJDIR)\*.sym del $(OBJDIR)\*.sym
        -@if exist $(OBJDIR)\*.res del $(OBJDIR)\*.res
        -@if exist $(OBJDIR)\*.lib del $(OBJDIR)\*.lib
        -@if exist $(OBJDIR)\*.exp del $(OBJDIR)\*.exp
#for files generated by BUILD.EXE begin
        -@if exist $(OBJDIR)\*.mac del $(OBJDIR)\*.mac
        -@if exist $(OBJDIR)\i386\nul echo Y | del $(OBJDIR)\i386\*.* > nul
        -@if exist $(OBJDIR)\i386\nul rd $(OBJDIR)\i386
#for files generated by BUILD.EXE end
        -@if exist $(OBJDIR)\R*    del $(OBJDIR)\R*
        -@if exist $(OBJDIR)\nul rd  $(OBJDIR)
        -@if exist *.lst del *.lst
        -@if exist *.pdb del *.pdb
        -@if exist *.bak del *.bak
